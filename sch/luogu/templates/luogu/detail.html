{% extends "luogu/base.html" %}
{% load staticfiles %}
{% block jsUp %}
    <!--引入样式文件-->
{#    <link rel="stylesheet" href="{% static 'luogu/makeNews/examples/css/style.css' %}"/>#}
{#    <link rel="stylesheet" href="{% static 'luogu/makeNews/css/editormd.preview.css' %}"/>#}
    <!--引入js文件-->
{#    <script src="{% static 'luogu/makeNews/examples/js/jquery.min.js' %}"></script>#}
{#    <script src="{% static 'luogu/makeNews/lib/marked.min.js' %}"></script>#}
{#    <script src="{% static 'luogu/makeNews/lib/prettify.min.js' %}"></script>#}
{#    <script src="{% static 'luogu/makeNews/lib/raphael.min.js' %}"></script>#}
{#    <script src="{% static 'luogu/makeNews/lib/underscore.min.js' %}"></script>#}
{#    <script src="{% static 'luogu/makeNews/lib/sequence-diagram.min.js' %}"></script>#}
{#    <script src="{% static 'luogu/makeNews/lib/flowchart.min.js' %}"></script>#}
{#    <script src="{% static 'luogu/makeNews/lib/jquery.flowchart.min.js' %}"></script>#}
{#    <script src="{% static 'luogu/makeNews/editormd.js' %}"></script>#}


  <link href="{% static 'mdeditor/css/editormd.min.css' %}" rel="stylesheet">
  <link href="{% static 'mdeditor/css/editormd.preview.css' %}" rel="stylesheet">

  <script src="{% static 'mdeditor/js/jquery.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/editormd.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/marked.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/prettify.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/raphael.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/underscore.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/sequence-diagram.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/flowchart.min.js' %}"></script>
  <script src="{% static 'mdeditor/js/lib/jquery.flowchart.min.js' %}"></script>



	<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
  $(function () {
      // js 解析markdown
      editormd.markdownToHTML("content", {
          //htmlDecode      : "style,script,iframe",  // you can filter tags decode
          emoji           : true,
          taskList        : true,
          tex             : true,  // 默认不解析
          flowChart       : true,  // 默认不解析
          sequenceDiagram : true,  // 默认不解析
      });
      editormd.markdownToHTML("content2", {
          //htmlDecode      : "style,script,iframe",  // you can filter tags decode
          emoji           : true,
          taskList        : true,
          tex             : true,  // 默认不解析
          flowChart       : true,  // 默认不解析
          sequenceDiagram : true,  // 默认不解析
      });

      $(".reference-link").each(function (i,obj) {
        console.log(obj)
      })
  })

</script>
{% endblock %}
{% block main %}
    <div style="background-color: rgba(0, 0, 0, .75); height: 15%">
        <div style="height: 5%"></div>
        <div style="margin-left: 20px;" align="left">
            <h5 style="color: white;">题目详情</h5>
        </div>

        <div style="height: 5%"></div>
        <div style="float: left; margin-left: 20px">
            <h3 id="no" style="color: white;">
                {{ question.no }}
            </h3>
        </div>
        <div style="float: left; margin-left: 20px"><h3 style="color: white">{{ question.title }}</h3></div>
        <div style="position: fixed; right: 20%; top: 10%">
            <button type="button" class="btn btn-success" style="border-radius: 50%">
                <a target="_blank" href="/write_note/{{ question.no }}/"><h3 style="color: white"  data-html="true"
			data-container="body" data-toggle="popover" data-placement="bottom" data-trigger="hover"
			data-content="
			<script>
                $(function () {
                      editormd.markdownToHTML('note', {
                          //htmlDecode      : 'style,script,iframe',
                          emoji: true,
                          taskList: true,
                          tex: true,  // 默认不解析
                          flowChart: true,  // 默认不解析
                          sequenceDiagram: true,  // 默认不解析
                      });
                  });
            </script>
			<div id='note'><textarea>{{ note|safe }}</textarea></div>">笔记
            </h3></a>
            </button>

        </div>
    </div>



    <div style="min-height: 800px">
        <div style="width: 70%;float: left;height: 100%">
            <div style="min-height: 350px;margin: 20px 51.729px 0px; ">

                <div style="display: block;box-sizing: border-box;overflow: hidden;height: 100% ">
                    <div style="padding: 0px 10px;overflow: hidden;height: 100%">
                        <div style="height: 100%; margin: 0px 0px 15px;padding: 16px;background-color: rgba(255,255,255,.7);overflow: hidden;">

                            <div style="width: 100%; height: 100%">
                                <div style="height: 90%;">
                                    <div style="text-align: left; margin-left: 20px"><h3 style="color: black">题目描述</h3></div>

{#                                    <div id="question" style="height: 100%;">#}
{#                                        {{ question.question|safe }}#}
{#                                    </div>#}
{#                                    <div style="height: 100%;text-align: left;font-size: 14px;line-height: 1.6;padding: 20px;overflow: auto;">#}
{#                                        {{ question.question|safe }}#}
{#                                    </div>#}
                                    <div id="content"><textarea>{{ question.question|safe }}</textarea></div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div id="feedback" style="height: 9%;">
{#                <div style="float: left;width: 40%; margin-left: 10%"><h1>做对了吗傻逼</h1></div>#}
{#                <div style="float: left">#}
{#                    <button id="wa" onclick="wa()" style="float: left; border-radius: 5px;font-size: 1.4rem;color: #fff;background-color: #dd514c;border-color: #dd514c;display: inline-block;margin-bottom: 0;#}
{#                        padding: .5em 1em;font-weight: 400;line-height: 1.2;text-align: center;white-space: nowrap;border: 1px solid transparent;cursor: pointer;outline: 0;#}
{#                        transition: background-color 300ms ease-out,border-color 300ms ease-out;vertical-align: middle;text-transform: none;overflow: visible;font-family: inherit;">#}
{#                        <h3>下次一定</h3>#}
{#                    </button>#}
{#                    <button id="ac" onclick="ac()" style="float: left; border-radius: 5px;font-size: 1.4rem;color: #fff;background-color: #5cb85c;border-color: #0a6999;display: inline-block;margin-bottom: 0;#}
{#                        padding: .5em 1em;font-weight: 400;line-height: 1.2;text-align: center;white-space: nowrap;border: 1px solid transparent;cursor: pointer;outline: 0;#}
{#                        transition: background-color 300ms ease-out,border-color 300ms ease-out;vertical-align: middle;text-transform: none;overflow: visible;font-family: inherit;">#}
{#                        <h3>对了吧</h3>#}
{#                    </button>#}
{#                </div>#}
{#                <div style="clear:both"></div>#}

            </div>
{#            <div style="margin: 20px 51.729px 0px; height: 30%;width: 70%;">#}
            <div style="min-height: 350px;margin: 0 51.729px; ">
                <div style="display: block;box-sizing: border-box;overflow: hidden; height: 100%">
                    <div style="padding: 0px 10px;overflow: hidden;height: 100%">
                        <div style="height: 100%; margin: 0px 0px 15px;padding: 16px;background-color: rgba(255,255,255,.7);overflow: hidden;">

                            <div style="width: 100%; height: 100%">
                                <div style="height: 95%;">
                                    <div style="text-align: left; margin-left: 20px;height: 10%"><h3 style="color: black">参考答案</h3></div>

                                    <div style="height: 80%;">
{#                                        <div id="answer" style="display: none;height: 100%;text-align: left;font-size: 14px;line-height: 1.6;padding: 20px;overflow: auto;">#}
{#                                            {{ question.answer|safe }}#}
{#                                        </div>#}
                                        <div id="content2" style="display: none; position:relative"><textarea>{{ question.answer|safe }}</textarea></div>

                                        {% if request.session.is_login %}
                                            <button id="btnA" onclick="mdToHmlA();" style="min-height:200px; width: 100%; position:relative;">点击查看答案</button>
                                        {% else %}
                                            <button onclick="window.location.href='/login'" style="min-height:200px; width: 100%">
                                                登录查看答案
                                            </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div style=" width: 20%; float: left;background-color:red;margin: 20px 0px 0px">
             <button onclick="window.open('/scratchpaper')" style="min-height: 700px;width: 100%; background-color:white;">
                 <div style="margin-top: 50px;height: 100px"><span style="font-size: large; font-weight: bold">点</span></div>
                 <div style="height: 100px;"><span style="font-size: large; font-weight: bold">击</span></div>
                 <div style="height: 100px;"><span style="font-size: large; font-weight: bold">获</span></div>
                 <div style="height: 100px;"><span style="font-size: large; font-weight: bold">取</span></div>
                 <div style="height: 100px;"><span style="font-size: large; font-weight: bold">草</span></div>
                 <div style="height: 100px;"><span style="font-size: large; font-weight: bold">稿</span></div>
                 <div style="height: 100px;"><span style="font-size: large; font-weight: bold">纸</span></div>
             </button>

        </div>
    </div>
{% endblock %}

{% block js %}

    <script>
        $(function () {
            $("[data-toggle='popover']").popover({
                delay:{
                    show:0,
                    hide:4000
                }
            });
        });
    </script>

    <script type="text/javascript">
        $.ajaxSetup({
            data:{
                csrfmiddlewaretoken: '{{ csrf_token }}'
            }
        })
        {#function mdToHml() {#}
        {#    //先对容器初始化，在需要展示的容器中创建textarea隐藏标签，#}
        {#    $("#question").html('<textarea id="appendTest1" style="display:none;">你</textarea>');#}
        {##}
        {#    var content = document.getElementById("abc").innerHTML;//获取需要转换的内容#}
        {#    $("#appendTest1").val(content);//将需要转换的内容加到转换后展示容器的textarea隐藏标签中#}
        {#    editormd.markdownToHTML("question", {#}
        {#        htmlDecode: "style,script,iframe", //可以过滤标签解码#}
        {#        emoji: true,#}
        {#        taskList: true,#}
        {#        tex: true,               // 默认不解析#}
        {#        flowChart: true,         // 默认不解析#}
        {#        sequenceDiagram: true,  // 默认不解析#}
        {#    });#}

        function mdToHmlA() {
            $("#feedback").html(
                "        <div style=\"float: left;width: 40%; margin-left: 10%\"><h1>做对了吗傻逼</h1></div>\n" +
                "        <div style=\"float: left\">\n" +
                "            <button id=\"wa\" onclick=\"wa()\" style=\"float: left; border-radius: 5px;font-size: 1.4rem;color: #fff;background-color: #dd514c;border-color: #dd514c;display: inline-block;margin-bottom: 0;\n" +
                "                padding: .5em 1em;font-weight: 400;line-height: 1.2;text-align: center;white-space: nowrap;border: 1px solid transparent;cursor: pointer;outline: 0;\n" +
                "                transition: background-color 300ms ease-out,border-color 300ms ease-out;vertical-align: middle;text-transform: none;overflow: visible;font-family: inherit;\">\n" +
                "                <h3>下次一定</h3>\n" +
                "            </button>\n" +
                "            <button id=\"ac\" onclick=\"ac()\" style=\"float: left; border-radius: 5px;font-size: 1.4rem;color: #fff;background-color: #5cb85c;border-color: #0a6999;display: inline-block;margin-bottom: 0;\n" +
                "                padding: .5em 1em;font-weight: 400;line-height: 1.2;text-align: center;white-space: nowrap;border: 1px solid transparent;cursor: pointer;outline: 0;\n" +
                "                transition: background-color 300ms ease-out,border-color 300ms ease-out;vertical-align: middle;text-transform: none;overflow: visible;font-family: inherit;\">\n" +
                "                <h3>对了吧</h3>\n" +
                "            </button>\n" +
                "        </div>\n" +
                "<div style=\"clear:both\"></div>\n"

            );
            $("#btnA").hide();
            $("#content2").show();
            $.ajax({
                url: "/feedback",
                type: "post",
                async: false,
                data: {
                    {#"subject": document.getElementById("subject").innerText.slice(),#}
                    "subject": document.getElementById("no").innerText.slice(0, -4),
                    "no": document.getElementById("no").innerText.slice(-4),
                    "status": "wa",
                    csrfmiddlewaretoken: '{{ csrf_token  }}'
                },
                success: function (res) {

                }
            })

        }
        function ac() {
            $.ajax({
                url: "../feedback",
                type: "post",
                async: false,
                data: {
                    "subject": document.getElementById("no").innerText.slice(0, -4),
                    "no": document.getElementById("no").innerText.slice(-4),
                    "status": "ac",
                    csrfmiddlewaretoken: '{{ csrf_token  }}'
                },
                success: function (res) {
                    $("#feedback").html(
                        "       <div style='margin-left: 60%'>\n" +
                        "            <button onclick='window.open(\"/write_note/{{ question.no }}/\")' style=\"float: left; border-radius: 5px;font-size: 1.4rem;color: #fff;background-color: #5cb85c;border-color: #0a6999;display: inline-block;margin-bottom: 0;\n" +
                        "                padding: .5em 1em;font-weight: 400;line-height: 1.2;text-align: center;white-space: nowrap;border: 1px solid transparent;cursor: pointer;outline: 0;\n" +
                        "                transition: background-color 300ms ease-out,border-color 300ms ease-out;vertical-align: middle;text-transform: none;overflow: visible;font-family: inherit;\">\n" +
                        "                <h3>记一下笔记</h3>\n" +
                        "            </button>\n" +
                        "        </div>\n" +
                        "<div style=\"clear:both\"></div>\n"
                    );
                }
            })
        }
        function wa() {
            $("#feedback").html(
                        "       <div style='margin-left: 60%'>\n" +
                        "            <button onclick='window.open(\"/write_note/{{ question.no }}/\")' style=\"float: left; border-radius: 5px;font-size: 1.4rem;color: #fff;background-color: #5cb85c;border-color: #0a6999;display: inline-block;margin-bottom: 0;\n" +
                        "                padding: .5em 1em;font-weight: 400;line-height: 1.2;text-align: center;white-space: nowrap;border: 1px solid transparent;cursor: pointer;outline: 0;\n" +
                        "                transition: background-color 300ms ease-out,border-color 300ms ease-out;vertical-align: middle;text-transform: none;overflow: visible;font-family: inherit;\">\n" +
                        "                <h3>记一下笔记</h3>\n" +
                        "            </button>\n" +
                        "        </div>\n" +
                        "<div style=\"clear:both\"></div>\n"
            );
        }
    </script>
{% endblock %}